13:15 25/01/2023

--seleccionar el numero de empleados que trabaja en cada pais 
--que trabaja en cada pais no este en la region de Asia


select country_name, count(employee_id)
from employees join departments using (department_id)
join locations using (location_id)
join countries using (country_id)
join regions using (region_id)
where region_name != 'Asia'
group by country_name;

--seleccionar el numero de empleados que trabaja en cada pais 
--que trabaja en cada pais no este en la region de Asia
--siendo el num de empleados mayor que 5

select country_name, count(employee_id)
from employees join departments using (department_id)
join locations using (location_id)
join countries using (country_id)
join regions using (region_id)
where region_name != 'Asia'
group by country_name
having count (employee_id)>5;

---lo mismo pero seleccionando la media

select country_name, count(employee_id),AVG(salary)
from employees join departments using (department_id)
join locations using (location_id)
join countries using (country_id)
join regions using (region_id)
where region_name != 'Asia'
group by country_name
having count (employee_id)>5
having max(salary) > 10000;

---lo mismo pero con ciudad

select country_name,city, count(employee_id),AVG(salary)
from employees join departments using (department_id)
join locations using (location_id)
join countries using (country_id)
join regions using (region_id)
where region_name != 'Asia'
group by country_name,city
having count (employee_id)>5
having max(salary) > 10000;


********************************************************************
*LAS CONDICIONES DEL HAVING SOLO DEBE APARECER ESTO : COUNT ,SUM ,MAX,MIN,AVG."solo estas 5"
PERO NUNCA UNA CONDICION POR EJMPLO: having country_name != 'united Kindog'*
*este ejemplo se deberia poner en el where*
en select se pone solo que queremos que se muestre
***********************************************************************


BASE DE DATOS DE CLIMATOLOGIA
-----------------------------
--seleccionar la precipitacion media del mes de marzo agrupado por estacion 

select estacion,provincia ,avg(precipitacion_total)
from climatologia
where extract(month from fecha)=3
group by estacion,provincia;

--seleccionar la emdia de la temperatura media agrupando por provincia y mes .
-- ordena los resultados
--por provincia asc y cronologicamente (enero,febrero...)

select to_char(fecha,'TMMonth')as "mes"*, avg(temperatura_media),provincia
from climatologia 
group by fecha,provincia,to_char(fecha,'TMMonth')
order by provincia,mes ;
*esas comillas son un alias

--selecionar el numero de vuelos que salen en media 
--cada dia de la semana (lun mart)
--agrupando por aeroperto de salida

select ciudad,to_char(salida,'TMDay')as"dia",
count(*)
from vuelo vu join aeropuerto ar on (vu.desde=ar.id_aeropuerto)
group by ciudad,to_char(salida,'TMDay')
order by ciudad,dia ;

*PARA ESTE EJERCICIO HABIA QUE HACER UNA SUBCONSULTA ¡. EL EJERCICIO QUEDARIA ASI *
select ciudad,to_char(salida,'TMDay')as"dia",
count(*)
from vuelo vu join aeropuerto ar on (vu.desde=ar.id_aeropuerto)
group by ciudad,to_char(salida,'TMDay')
order by ciudad,dia ;

select ciudad ,avg(numval)
from(select ciudad,to_char(salida,'TMDay')as"dia",
count(*)as "numval"
from vuelo vu join aeropuerto ar on (vu.desde=ar.id_aeropuerto)
group by ciudad,to_char(salida,'TMDay')
order by ciudad,dia )datos
group by ciudad;

--SELCIBNAR EL SALARIO MEDIO MAXIMO AGRUPANDO POR DEPARTMANETO
--yo solito:)

select max(numval)
from(SELECT department_name, avg(salary) as "numval"
from employees join departments using (department_id)
group by department_name)d;

--sacar el nombre del departamento del que su media haya sido el maximo
*en este caso no hace falta hacer subconsulta*
********este ejemplo es uno de lso tipicos de los qe va a preguntar*********
select department_name ,avg(salary) as "media"
from employees join departments using (department_id)
group by department_name 
order by department_name 
limit 1;



<<<<<<< HEAD
----------------------------------------10:56 26/01/2023--------------------------------------------

*CORRECCION DE DEL EJERCICO 1*


-- 4 select street_address,count(employee_id) as"num"
from employees right join departments using (department_id)
left join locations using (location_id)
group by street_address;

--5
select salary,count(*)
from employees
 group by salary 
order by count(*) desc 
limit 1;

select salary,count(*)
from employees 
group salary
having count(*)
NO TERMINADO ....



=======
1
>>>>>>> a5608e349f16b0181ebcbae911a14b6b6f9f5719
mgangel — ayer a las 21:07



---------------------------------------9:11 27/01/2023-----------------------------------------




--1
select count(order_id)as "ha",employee_id
from employees join orders using (employee_id)
group by employee_id
having count(order_id) between 100 and 150; 
--2
select company_name 
from orders join shippers on (order_id=shipper_id)

group by shipper_id;
--3
select max(numval)
from(select category_id, (category_name) as "numval"
from categories
group by category_name,category_id)d;
--4
select o.unit_price+25
from order_details o join products pr on(o.order_id=pr.product_id)
join categories using (product_id)
group by category_id,product_id;

--5
select customer_id,order_id
from orders join customers cu using (customer_id)
where company_name = 'United Package'
group by order_id;

**CORRECCION DE EJERCICIO 1**

1.6:Seleccionar el número de empleados que empezaron a 
trabajar cada año, ordenando la salida por el año

seect to_char(hire_date,yyyy)as "año",count(*)
from employees
group by año 
order by año;

**CORRECION DEL EJERCICIO 2**



--seleccionar aquellos empleados que cobran menos que el empleado 145
select fisrt_name,last_name ,salary
from employees
where salary <(select salary
		from employees
		where employee_id=145);
No hay que ponerle alias .Solo a las subsconsultas del from 
todas las subconsultas que tenga un <,>.<=... como esta ultima siempre tienen que devolver un unico valor
 
--seleccionar los datos de aqulos empleados que cobre lo mismo 
--y esten en los mismo departamentos

select employee_id, fisrt_name,last_name ,salary
from employees
where (salary,department_id)= (select salary
		from employees
		where employee_id=101);

--selciionar los datos de aquellos empleados que 
--cobren mas que los empleados del departmento de Administyracion
select *
from employees join departments using(department_id)
where salary > all(select salary
		from employees join departments using (department_id)
		where department_name = 'Purchasing';

--selecionar los datos de aqullos empleados que cobren 
--mas que la media de salarios de los empeados 
--del departmento de Purchasing

select * 
from employees 
where salary > (select avg(salary)
				  from employees join departments using (department_id)
				  where department_name= 'Purchasing');

--seleccionar los empleados que tienen los mismos 
--salarios que los empleados del departamento
--de purchasing

select * 
from employees 
where salary  in (select avg(salary)
				  from employees join departments using (department_id)
				  where department_name= 'Purchasing');
**EL IN ES MUY IMPORTANTE **

2.5:Selecciona aquellos clientes (CUSTOMERS) para los que todos los envíos que 
ha recibido (sí, todos) los haya transportado (SHIPPERS) la empresa United Package.

LO CORREGIMOS DESPUE DEL FINDE 


--seleccionar aquellos departamentgos donde TODOS los empleados se contraron en el año 1994
select department_id
from employees join departments using (departments_id)
where employee_id not in(select employee_id
					from employees join departments using (department_id)
					where extraxct(year from hire_date)!=1994);

-------------------------------------------10:12 02/02/2023--------------------------------------

SUBCONSULTAS CORELACIONADAS

--los 5 empleados que mas cobran
select *
from employees
where salary in(select distinct salary
			   from employees
			   order by salary desc
			   limit 5);

--seleccionar los departamentos 
--con los empleados con salarios 
--mas altos. Debe aparecer el nombre del
--departamento y los 5 salario mas alto de dicho 
--departamento
select department_name,max (salary) as "maxi"
from employees join departments using (department_id)
group by department_name
having max(salary) in (select distinct max (salary) as "maxi" 
					   from employees join departments using (department_id)
					   group by department_name
					   order by maxi desc
					   limit 5
					  );
algunas subconsultas

-------------------9:39 03/02/2023----------------------------
**SUBCONSULTAS CORELACIONADAS**


--selecionar mostrando la provincia ,estacion y temperatura maxima
--mas alta de cada provincia
--para el mes de enero de 2019
select provincia,estacion,temperatura_maxima
from climatologia cli
where to_char(fecha,  'MM/YYYY')= '01/2019'
and temperatura_maxima >= all(SELECT temperatura_maxima
						   from climatologia cli2
							  where to_char(fecha,  'MM/YYYY')= '01/2019'
						   and cli2.provincia=cli.provincia );

--selecionar mostrando la provincia ,estacion y temperatura minima
--mas alta de cada provincia
--para el mes de enero de 2019
select provincia,estacion,temperatura_minima
from climatologia cli
where to_char(fecha,  'MM/YYYY')= '01/2019'
and temperatura_minima <= all(SELECT temperatura_minima
						   from climatologia cli2
							  where to_char(fecha,  'MM/YYYY')= '01/2019'
						   and cli2.provincia=cli.provincia );

--seleccionar el nombre del departamento
--el nombre completo del empleado y su salario 
-- para el empleado que cobra mas de cada 
--departamento
<<<Yo solito:)>>>	
select department_name,first_name,last_name,salary
from employees  join departments e1 using (department_id)
where salary >= all(select salary
				   from employees  join departments e2 using (department_id)
				   where e1.department_name=e2.department_name);

-------------------------------12:52 06/02/2023------------------------------------
 cunado en el enuncion poner TODOS
hay que poner todos - la condicion inversa ,es decir , not in


BOLETIN  2 *
___________*
--ejercicio 3
selct customers.*
from customers join orders using (customer_id)
where customer_id not in (select distinct customer_id
from orders join shippeers s on (shipper_id =ship_via)
where company_name is not 'united packed');

BOLETIN 3  *
___________*
--ejercicio 1
select nombre, count(id_reserva) "trafico"
from vuelo join reserva using (id_vuelo)
join aeropuerto on (hasta=id_aeropuerto)
where extract (month from llegada ) in (1,2,3)
group by nombre
order by trafico 
limt 3;

--ejercicio 4
select salida.nombre, llegada.nombre
age(vuelo.llegada,vuelo.salida)
from vuelo join aeropuerto salida on (vuelo.salida= salida.id_aeropuerto)
join aeropuerto llegada on (vuelo.llegada=llegada.id_aeropuerto)
where id_vuelo in(select id_vuelo
from vuelo
order by age(llegada,salida)
limit 10);

***como saber la duracion de un vuelo***
select id_vuelo
from vuelo
order by age(llegada,salida)
limit 10;

--ejercicio 2
select 
from cliente join operacion using (id_cliente)
join inmueble using (id_inmueble)
join tipo on (id_tipo=tipo_inmueble)
where precio_final >= all (select max (precio_final)

----------------------------------13:37 08/02/2023----------------------------------------

CORRECCION DEL EJERCICIO 4
4.1
select *, to_char(salida, 'ID'), max(age(llega,salida))
from vuelo join aeropuerto d on (d.id_aeropuerto = vuelo.desde)
join aeropuerto h on (h.id_aeropuerto = vuelo.hasta)
group by to_char (salida, 'ID');

--- OTRA FORMA 
select d.ciudad, h.ciudad,salida,llegada







